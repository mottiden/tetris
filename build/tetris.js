"use strict";function arenaSweep(){var e=1;e:for(var r=arena.length-1;r>0;--r){for(var a=0;a<arena[r].length;++a)if(0===arena[r][a])continue e;var t=arena.splice(r,1)[0].fill(0);arena.unshift(t),++r,player.score+=10*e,e*=2}}function collide(e,r){for(var a=r.matrix,t=r.pos,n=0;n<a.length;++n)for(var o=0;o<a[n].length;++o)if(0!==a[n][o]&&0!==(e[n+t.y]&&e[n+t.y][o+t.x]))return!0;return!1}function createMatrix(e,r){for(var a=[];r--;)a.push(new Array(e).fill(0));return a}function createPiece(e){return"I"===e?[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]:"L"===e?[[0,2,0],[0,2,0],[0,2,2]]:"J"===e?[[0,3,0],[0,3,0],[3,3,0]]:"O"===e?[[4,4],[4,4]]:"Z"===e?[[5,5,0],[0,5,5],[0,0,0]]:"S"===e?[[0,6,6],[6,6,0],[0,0,0]]:"T"===e?[[0,7,0],[7,7,7],[0,0,0]]:void 0}function drawMatrix(e,r){e.forEach(function(e,a){e.forEach(function(e,t){0!==e&&(context.fillStyle=colors[e],context.fillRect(t+r.x,a+r.y,1,1))})})}function draw(){context.fillStyle="#000",context.fillRect(0,0,canvas.width,canvas.height),drawMatrix(arena,{x:0,y:0}),drawMatrix(player.matrix,player.pos)}function merge(e,r){r.matrix.forEach(function(a,t){a.forEach(function(a,n){0!==a&&(e[t+r.pos.y][n+r.pos.x]=a)})})}function rotate(e,r){for(var a=0;a<e.length;++a)for(var t=0;t<a;++t){var n=[e[a][t],e[t][a]];e[t][a]=n[0],e[a][t]=n[1]}r>0?e.forEach(function(e){return e.reverse()}):e.reverse()}function playerDrop(){player.pos.y++,collide(arena,player)&&(player.pos.y--,merge(arena,player),playerReset(),arenaSweep(),updateScore()),dropCounter=0}function playerMove(e){player.pos.x+=e,collide(arena,player)&&(player.pos.x-=e)}function playerReset(){player.matrix=createPiece("TJLOSZI"["TJLOSZI".length*Math.random()|0]),player.pos.y=0,player.pos.x=(arena[0].length/2|0)-(player.matrix[0].length/2|0),collide(arena,player)&&(arena.forEach(function(e){return e.fill(0)}),player.score=0,updateScore())}function playerRotate(e){var r=player.pos.x,a=1;for(rotate(player.matrix,e);collide(arena,player);)if(player.pos.x+=a,(a=-(a+(a>0?1:-1)))>player.matrix[0].length)return rotate(player.matrix,-e),void(player.pos.x=r)}function update(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(dropCounter+=e-lastTime)>dropInterval&&playerDrop(),lastTime=e,draw(),requestAnimationFrame(update)}function updateScore(){document.getElementById("score").innerText=player.score}var canvas=document.getElementById("tetris"),context=canvas.getContext("2d");context.scale(20,20);var dropCounter=0,dropInterval=1e3,lastTime=0;document.addEventListener("keydown",function(e){37===e.keyCode?playerMove(-1):39===e.keyCode?playerMove(1):40===e.keyCode?playerDrop():81===e.keyCode?playerRotate(-1):87===e.keyCode&&playerRotate(1)});var colors=[null,"#FF0D72","#0DC2FF","#0DFF72","#F538FF","#FF8E0D","#FFE138","#3877FF"],arena=createMatrix(12,20),player={pos:{x:0,y:0},matrix:null,score:0};playerReset(),updateScore(),update();